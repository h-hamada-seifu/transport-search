# NAVITIME API の代替案調査

## 概要

現在、進路ナビ（transport-search）はRapidAPI経由でNAVITIME APIを使用していますが、無料枠（500回/月）を超えた場合、月額$400（約60,000円）のコストが発生します。このドキュメントでは、コスト削減を目的とした代替APIサービスを比較・検討します。

---

## 1. 現状のコストと課題

### 1.1 現在の使用API

| API名 | 用途 | 月間制限（無料） | 有料プラン（Pro） |
|------|------|---------------|----------------|
| NAVITIME Transport | 駅検索（出発地） | 500件 | $200/月（5,000件） |
| NAVITIME Route(totalnavi) | ルート検索 | 500件 | $200/月（5,000件） |
| **合計** | - | - | **$400/月（約60,000円）** |

### 1.2 課題

- 小規模運用（月間100ユーザー程度）には高額すぎる
- 各APIごとに別契約が必要
- RapidAPIでは最大10,000件/月までしか対応していない

---

## 2. 代替APIサービスの比較

### 2.1 Google Maps Platform（❌ 日本の鉄道非対応）

#### 基本情報
- **Directions API**: $5/1,000リクエスト（Essentials）
- **Routes API**: $5/1,000リクエスト（Essentials）
- **無料枠**: 10,000リクエスト/月

#### 致命的な制限
> **重要**: Google Maps APIは日本の鉄道路線検索に対応していません。
> - Transit modeは日本の鉄道に非対応（バス・徒歩のみ）
> - Walking/Drivingモードのみ利用可能

**結論**: ❌ **採用不可**（日本の公共交通機関に非対応）

---

### 2.2 駅すぱあと API（ヴァル研究所）

#### プラン一覧

| プラン | 月額料金 | リクエスト数 | 機能 | 備考 |
|--------|---------|------------|------|------|
| **フリープラン** | ¥0 | 制限不明 | 鉄道・航空情報、簡易経路探索 | 時刻表情報なし |
| **買い切り型** | ¥5,500〜 | 5,000〜20,000件 | 経路探索（システム連携可能） | Amazon購入可能 |
| **スタンダード** | 要問い合わせ | 従量制 | 全機能（範囲探索、公共交通データ等） | 90日無料評価版あり |
| **エンタープライズ** | 要問い合わせ | 従量制 | オンプレミス対応 | 大規模向け |

#### フリープランの機能制限

**利用可能な機能**:
- 駅情報の取得（駅名、路線名など）
- 平均待ち時間探索（移動経路のみ）
- 駅すぱあと for webへの遷移URL生成

**利用不可の機能**:
- ❌ **電車の時刻表情報**（出発時刻・到着時刻）
- ❌ バス情報
- ❌ 運行情報（遅延情報等）

#### コスト試算（買い切り型プランの場合）

| リクエスト数 | 料金 | 月間コスト（年間プラン想定） |
|------------|------|---------------------------|
| 5,000件 | ¥5,500 | ¥5,500 |
| 10,000件 | ¥11,000 | ¥11,000 |
| 20,000件 | ¥22,000 | ¥22,000 |

**NAVITIME（$400/月）との比較**:
- 10,000件プランの場合: ¥11,000/月 vs $400（約60,000円）
- **約81%のコスト削減**が可能

**結論**: ✅ **有力候補**（時刻表が不要な場合）

---

### 2.3 ジョルダン 乗換案内API

#### 乗換案内オープンAPI

**対象**: オープン用途のみ（イントラネット利用不可）

**制限**:
- 月間合計10,000回まで
- 1API あたり3,000回まで

**料金**: 無料（オープン用途のみ）

#### 乗換案内Biz API

**対象**: 法人向け（ワークフローシステム、旅費精算システム連携等）

**料金**: 要問い合わせ

**結論**: △ **要確認**（オープンAPI利用可能か、Biz APIの料金次第）

---

### 2.4 GTFSオープンデータ + 自前実装（❌ 実装コスト大）

#### 概要

日本の公共交通オープンデータ（GTFS形式）を使用し、独自の経路探索システムを構築する方法。

**利用可能なデータ**:
- **公共交通オープンデータ協議会**: 無料登録でAPIアクセス可能
- **GTFSデータリポジトリ**: 280以上の自治体・事業者がデータ公開（2024年7月時点）
- **標準的なバス情報フォーマット（GTFS-JP）**: 国土交通省が標準化

**実装方法**:
- **OpenTripPlanner**: オープンソースの経路探索エンジン
- GTFS/GTFS-RTデータを使用してリアルタイム遅延を考慮した経路検索が可能

#### メリット
- ✅ **完全無料**（データ・ソフトウェアともにオープンライセンス）
- ✅ カスタマイズ自由

#### デメリット
- ❌ **実装コストが高い**（サーバー構築、データ更新メンテナンス必要）
- ❌ データ提供事業者が限定的（大手私鉄が含まれない可能性）
- ❌ インフラコスト（サーバー運用費）

**結論**: ❌ **採用不可**（小規模運用には過剰投資）

---

## 3. 推奨案と実装方針

### 3.1 推奨: 駅すぱあと API（買い切り型プラン）

#### 選定理由

1. **コストパフォーマンス**:
   - 10,000件で¥11,000/月（NAVITIMEの約1/5）
   - 月間500ユーザーまで対応可能（1ユーザー20回検索想定）

2. **機能的な妥当性**:
   - 現在のアプリでは**時刻表情報を表示していない**
   - 必要なのは「所要時間」と「距離」のみ
   - 駅すぱあと買い切り型プランで実現可能

3. **導入の容易さ**:
   - Amazon経由で即座に購入可能
   - API仕様がシンプル（経路探索機能のみ）

#### 移行時の注意点

**確認が必要な項目**:
- [ ] 買い切り型プランで「所要時間」と「距離」が取得できるか
- [ ] 乗換回数が取得できるか
- [ ] 特急料金除外などのフィルタリングが可能か

**推奨アクション**:
1. 駅すぱあとAPI Testerで機能確認（キー不要）
   - URL: https://docs.ekispert.com/v1/le/
2. 必要に応じてスタンダードプランの90日無料評価版を申請

---

### 3.2 代替案: ジョルダン 乗換案内API（オープンAPI）

#### 選定理由

- **完全無料**（オープン用途のみ）
- 月間10,000回まで利用可能

#### 制約条件

- イントラネット利用不可（学内限定利用の場合は不適）
- オープン用途に限定される

#### 確認事項

- [ ] 学校職員向けアプリが「オープン用途」に該当するか
- [ ] API仕様の詳細確認

---

### 3.3 長期的な選択肢: 有料プラン（ユーザー増加時）

#### NAVITIMEスタンダードプラン（直接契約）

**対象**: 月間10,000件以上の大規模運用が必要な場合

**メリット**:
- RapidAPIの10,000件制限を超える利用が可能
- より専門的なオプション機能

**料金**: 要問い合わせ

---

## 4. 実装方針と移行手順

### 4.1 短期対応（無料枠内の運用）

**現状維持**: NAVITIME API（RapidAPI）を継続使用
- 月間100ユーザー程度なら無料枠内で運用可能
- API使用量を定期的に監視

### 4.2 中期対応（500回/月超過が見込まれる場合）

**駅すぱあと API（買い切り型）への移行**

#### ステップ1: 機能検証（1週間）
1. 駅すぱあとAPI Testerで機能確認
2. 必要に応じてスタンダードプランの90日評価版申請
3. 所要時間・距離・乗換回数の取得可否を確認

#### ステップ2: 実装（2週間）
1. 駅すぱあとAPI用のSDK/ライブラリ調査
2. API Routes（`app/api/`）の実装変更
3. レスポンス形式の変換ロジック実装

#### ステップ3: テスト＆移行（1週間）
1. 開発環境でのテスト
2. Vercel環境変数の変更
3. 本番デプロイ

#### コスト試算
- **初期費用**: ¥11,000（10,000件プラン）
- **月間コスト**: ¥11,000（買い切りなので追加費用なし）
- **年間コスト**: ¥132,000

**NAVITIMEとの比較**:
- NAVITIME年間コスト: $400 × 12 = $4,800（約72万円）
- 駅すぱあと年間コスト: ¥132,000
- **約82%のコスト削減**

---

## 5. 結論と推奨アクション

### 5.1 即座に実施すべき対応

1. **API使用量の監視強化**
   - RapidAPIダッシュボードで週次チェック
   - アラート設定（80%到達時に通知）

2. **駅すぱあとAPI Testerでの機能検証**
   - 所要時間・距離・乗換回数の取得可否
   - レスポンス形式の確認

### 5.2 制限超過が見込まれる場合の対応

**推奨**: 駅すぱあと API（買い切り型プラン 10,000件 ¥11,000）への移行
- コスト: NAVITIMEの約1/5
- 機能: 現在の要件を満たす可能性が高い

**代替**: ジョルダン 乗換案内オープンAPI（無料）
- 条件: オープン用途に該当する場合

### 5.3 長期的な検討事項

- ユーザー数が大幅に増加した場合（月間1,000ユーザー以上）
  - 駅すぱあとスタンダードプランの検討
  - NAVITIMEジャパンとの直接契約検討

---

## 6. 参考リンク

### 駅すぱあとAPI
- **公式サイト**: https://api-info.ekispert.com/
- **フリープランドキュメント**: https://docs.ekispert.com/v1/le/
- **Amazonで購入**: https://www.amazon.co.jp/s?k=駅すぱあとAPI

### ジョルダンAPI
- **乗換案内オープンAPI**: https://norikae.jorudan.co.jp/openapi/
- **乗換案内Biz API**: https://biz.jorudan.co.jp/service/biz_api.html

### GTFSオープンデータ
- **公共交通オープンデータ協議会**: https://www.odpt.org/
- **GTFSデータリポジトリ**: https://front.geospatial.jp/no44-1/
- **公共交通オープンデータ一覧**: https://tshimada291.sakura.ne.jp/transport/gtfs-list.html

---

## 更新履歴

- 2024-12-23: 初版作成（NAVITIME代替案調査結果）
